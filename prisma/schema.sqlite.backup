// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Benutzer für die Anwendung
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  password  String
  role      String @default("COORDINATOR")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Beziehungen
  assignedTasks TaskAssignment[]
  checklistItems ChecklistItem[]
  
  @@map("users")
}

// UserRole: ADMIN, COORDINATOR, STAFF

// Iftar Event Details
model Event {
  id          String   @id @default(cuid())
  title       String
  date        DateTime
  location    String
  description String?
  status      String @default("PLANNING")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Beziehungen
  guests      Guest[]
  tasks       Task[]
  checklistItems ChecklistItem[]
  programItems ProgramItem[]
  
  @@map("events")
}

// EventStatus: PLANNING, IN_PROGRESS, COMPLETED, CANCELLED

// Gäste / Davet Listesi
model Guest {
  id          String   @id @default(cuid())
  eventId     String
  name        String
  email       String?
  phone       String?
  title       String?  // Unvan/Title
  organization String? // Kurum/Organization
  tableNumber Int?     // Masa numarası
  isVip      Boolean  @default(false) // VIP misafir
  status      String @default("INVITED")
  arrivalTime DateTime? // Ankunftszeit am Event-Tag
  arrivalDate DateTime? // Anreisedatum (wann kommt der Gast an)
  needsSpecialReception Boolean @default(false) // Benötigt besonderen Empfang
  receptionBy String? // Wer empfängt diesen Gast
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@map("guests")
}

// GuestStatus: INVITED, CONFIRMED, ATTENDED, CANCELLED, NO_SHOW

// Aufgabenbereiche (9 Hauptbereiche)
model Task {
  id          String   @id @default(cuid())
  eventId     String
  category    String
  title       String
  description String?
  status      String @default("PENDING")
  priority    String @default("MEDIUM")
  dueDate     DateTime?
  completedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  assignments TaskAssignment[]
  checklistItems ChecklistItem[]
  
  @@map("tasks")
}

// TaskCategory: PROTOCOL, GUEST_LIST, GUEST_RECEPTION, SECURITY, HOTEL_COORDINATION, SAHUR_COORDINATION, MUSIC_TEAM, SPEAKER, HEADQUARTERS
// TaskStatus: PENDING, IN_PROGRESS, COMPLETED, BLOCKED
// Priority: LOW, MEDIUM, HIGH, URGENT

// Aufgaben-Zuweisungen
model TaskAssignment {
  id        String   @id @default(cuid())
  taskId    String
  userId    String
  role      String?  // Zusätzliche Rolle/Verantwortung
  createdAt DateTime @default(now())
  
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([taskId, userId])
  @@map("task_assignments")
}

// Checklisten-Items für jeden Bereich
model ChecklistItem {
  id          String   @id @default(cuid())
  eventId     String?
  taskId      String?
  category    String
  title       String
  description String?
  status      String @default("NOT_STARTED")
  assignedTo  String?
  dueDate     DateTime?
  completedAt DateTime?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  event       Event?   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  task        Task?    @relation(fields: [taskId], references: [id], onDelete: Cascade)
  assignedUser User?   @relation(fields: [assignedTo], references: [id], onDelete: SetNull)
  
  @@map("checklist_items")
}

// ChecklistStatus: NOT_STARTED, IN_PROGRESS, COMPLETED, BLOCKED

// Protokoll-Einträge
model Protocol {
  id          String   @id @default(cuid())
  eventId     String
  category    String
  title       String
  content     String   // Protokoll-Inhalt
  authorId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("protocols")
}

// Notizen und Dokumente
model Note {
  id          String   @id @default(cuid())
  eventId     String?
  taskId      String?
  category    String?
  title       String
  content     String
  authorId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("notes")
}

// Programmpunkte für Zeitplanung
model ProgramItem {
  id          String   @id @default(cuid())
  eventId     String
  type        String   // SPEECH, MUSIC, EZAN, QURAN, HITABET, IFTAR_START
  title       String   // Titel/Name des Programmpunkts
  speakerName String?  // Name des Konuşmacı/Kuran okuyan/Ezan okuyan
  topic       String?  // Konu/Thema
  duration    Int      // Dauer in Minuten
  startTime   DateTime // Startzeit
  order       Int      // Reihenfolge im Programm
  musicType   String?  // Musiktyp (wenn type = MUSIC)
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@map("program_items")
}

// ProgramItemType: SPEECH, MUSIC, EZAN, QURAN, HITABET, IFTAR_START
